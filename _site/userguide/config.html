<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Configuration | Webstrates</title>
	<meta name="description" content="A research prototype enabling collaborative editing of websites through DOM manipulations.">
	<link rel="stylesheet" href="/css/syntax.css">
	<link rel="stylesheet" href="/css/main.css">
</head>
<body>
	<div id="container">
		<header>
			<h1>
				<a class="brand" href="/">Webstrates</a>
				<small>A research prototype enabling collaborative editing of websites through DOM manipulations.</small>
			</h1>
		</header>
		<main>
			<div id="navigation">
				<ul class="nav nav-list">
					<li class="home"><a href="/">Home</a></li>
					<li>
						<a class="nav-header" href="">Getting started</a>
						<ul>
							<!--li><a href="/gettingstarted/motivation.html">Motivation</a></li-->
							<li><a href="/gettingstarted/installation.html">Installation</a></li>
							<li><a href="/gettingstarted/hello-world.html">Hello, world</a></li>
							<li><a href="/userguide/tutorials.html">Tutorials</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">User guide</a>
						<ul>
							<li><a href="/userguide/api.html">API</a></li>
							<li>
								<ul>
									<li><a href="/userguide/api/events.html">Events</a></li>
									<li><a href="/userguide/api/transient.html">Transient</a></li>
									<li><a href="/userguide/api/cookies.html">Cookies</a></li>
									<li><a href="/userguide/api/assets.html">Assets</a></li>
									<li><a href="/userguide/api/signaling.html">Signaling</a></li>
									<li><a href="/userguide/api/messaging.html">Messaging</a></li>
									<li><a href="/userguide/api/tagging.html">Tagging</a></li>
									<li><a href="/userguide/api/access-tokens.html">Access Tokens</a></li>
									<li><a href="/userguide/api/restore-delete.html">Restore/Delete</a></li>
								</ul>
							</li>
							<li><a href="/userguide/http-api.html">HTTP API</a></li>
							<li><a href="/userguide/server-config.html">Server Config</a></li>
							<li><a href="/userguide/client-config.html">Client Config</a></li>
							<li><a href="/userguide/versioning.html">Versioning</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">Developer guide</a>
						<ul>
							<li><a href="/developerguide/introduction.html">Introduction</a></li>
							<li><a href="/developerguide/how-it-works.html">How it works</a></li>
							<li><a href="/developerguide/creating-a-module.html">Creating a module</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div id="content">
				<div class="page-header">
					<h1>Configuration
						
					</h1>
				</div>
				<ul id="markdown-toc">
  <li><a href="#basic-settings" id="markdown-toc-basic-settings">Basic settings</a></li>
  <li><a href="#rate-limiting" id="markdown-toc-rate-limiting">Rate limiting</a></li>
  <li><a href="#authentication" id="markdown-toc-authentication">Authentication</a>    <ul>
      <li><a href="#server-level-basic-authentication" id="markdown-toc-server-level-basic-authentication">Server level basic authentication</a></li>
      <li><a href="#per-webstrate-permissions" id="markdown-toc-per-webstrate-permissions">Per-webstrate permissions</a></li>
      <li><a href="#default-permissions" id="markdown-toc-default-permissions">Default permissions</a></li>
      <li><a href="#permission-timeout" id="markdown-toc-permission-timeout">Permission timeout</a></li>
      <li><a href="#cookie" id="markdown-toc-cookie">Cookie</a></li>
    </ul>
  </li>
  <li><a href="#multi-threading" id="markdown-toc-multi-threading">Multi-threading</a></li>
  <li><a href="#tagging" id="markdown-toc-tagging">Tagging</a></li>
</ul>

<p>Webstrates ships with a sample configuration file
(<a href="https://github.com/Webstrates/Webstrates/blob/master/config-sample.json"><code class="highlighter-rouge">config-sample.json</code></a>)
that gets copied over to <code class="highlighter-rouge">config.json</code> if no <code class="highlighter-rouge">config.json</code> file is present when Webstrates starts.</p>

<h2 id="basic-settings">Basic settings</h2>

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">listeningAddress</code></td>
      <td>IP address to listen on.</td>
      <td><code class="highlighter-rouge">0.0.0.0</code> (all addresses)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">listeningPort</code></td>
      <td>Port to listen on.</td>
      <td><code class="highlighter-rouge">7777</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">db</code></td>
      <td>MongoDB connection url.</td>
      <td><code class="highlighter-rouge">mongodb://127.0.0.1:27017/webstrate</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">maxAge</code></td>
      <td>How long static files should be cached (not assets). Defined in milliseconds or using <a href="https://www.npmjs.com/package/ms">ms</a> format.</td>
      <td><code class="highlighter-rouge">1d</code> (24 hours)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">rateLimit</code></td>
      <td><a href="#rate-limiting">Configuration object for rate limiting</a></td>
      <td>See <a href="https://github.com/Webstrates/Webstrates/blob/master/config-sample.json"><code class="highlighter-rouge">config-sample.json</code></a>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">basicdAuth</code></td>
      <td><a href="#server-level-basic-authentication">Configuration object for basic auth</a></td>
      <td>See <a href="https://github.com/Webstrates/Webstrates/blob/master/config-sample.json"><code class="highlighter-rouge">config-sample.json</code></a>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">pubsub</code></td>
      <td>Reddis connection url (multithreading).</td>
      <td>unset</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">threads</code></td>
      <td>Number of threads to use (multihtreading).</td>
      <td>unset</td>
    </tr>
  </tbody>
</table>

<h2 id="rate-limiting">Rate limiting</h2>

<p>To avoid having clients DoS’ing the server unintentionally by having faulty Webstrates application
code, sending thousands of messages to the server per second, Webstrates allows for rate limiting
the number of requests.</p>

<p>Operations are generally a lot heavier on the server than other kinds of messages (keep alive,
signals, cookie changes, user messages), so these can be configured separately.</p>

<ul>
  <li><code class="highlighter-rouge">opsPerInterval</code> defines the number of operations allowed within the defined interval.</li>
  <li><code class="highlighter-rouge">signalsPerInterval</code> defines the number of signals (and other kind of messages) allowed within
the defined interval.</li>
  <li><code class="highlighter-rouge">intervalLength</code> defines the interval i milliseconds.</li>
  <li><code class="highlighter-rouge">banDuration</code> defines the ban duration in milliseconds.</li>
</ul>

<p>A decent configuration may be something like below, which allows 500 operations and 2000 signals
over a 15 second period:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"rateLimit"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"opsPerInterval"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
  </span><span class="nt">"signalsPerInterval"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w">
  </span><span class="nt">"intervalLength"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
  </span><span class="nt">"banDuration"</span><span class="p">:</span><span class="w"> </span><span class="mi">30000</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>With the above, the server will disconnect and ban any client (by IP) for 30 seconds if they exceed
the limitation.</p>

<h2 id="authentication">Authentication</h2>

<h3 id="server-level-basic-authentication">Server level basic authentication</h3>
<p>To enable basic HTTP authentication on the Webstrates server, add the following to <code class="highlighter-rouge">config.json</code>:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"basicAuth"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"realm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Webstrates"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some_username"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some_password"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="per-webstrate-permissions">Per-webstrate permissions</h3>
<p>It is possible to enable per webstrate access rights using <a href="https://github.com">GitHub</a> as authentication provider.
This requires <a href="https://github.com/settings/applications/new">registering an OAuth application with GitHub</a>. Afterwards, access to a specific webstrate may be restricted to a specific set of GitHub users.</p>

<p>Add the following to your <code class="highlighter-rouge">config.json</code>:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"auth"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"providers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"github"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"node_module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"passport-github"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"clientID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;github client id&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"clientSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;github secret&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"callbackURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://&lt;hostname&gt;/auth/github/callback"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Access rights are added to a webstrate as a <code class="highlighter-rouge">data-auth</code> attribute on the <code class="highlighter-rouge"><span class="nt">&lt;html&gt;</span></code> tag:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;html</span> <span class="na">data-auth=</span><span class="s">'[{"username": "cklokmose", "provider": "github", "permissions": "rw"},
  {"username": "anonymous", "provider": "", "permissions": "r"}]'</span><span class="nt">&gt;</span>
...
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>The above example provides the user with GitHub username <em>cklokmose</em> permissions to read and write (<code class="highlighter-rouge">rw</code>), while anonymous users only have read (<code class="highlighter-rouge">r</code>) access.</p>

<p>Users can log in by accessing <code class="highlighter-rouge">http://&lt;hostname&gt;/auth/github</code>.</p>

<p>In the future, more authentication providers will be supported.</p>

<h3 id="default-permissions">Default permissions</h3>

<p>It is also possible to set default permissions. Adding the following under the <code class="highlighter-rouge">auth</code> section in <code class="highlighter-rouge">config.json</code> will apply the same permissions as above to all webstrates without a <code class="highlighter-rouge">data-auth</code> property.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"defaultPermissions"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cklokmose"</span><span class="p">,</span><span class="w"> </span><span class="nt">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"github"</span><span class="p">,</span><span class="w"> </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rw"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"anonymous"</span><span class="p">,</span><span class="w"> </span><span class="nt">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"r"</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<h3 id="permission-timeout">Permission timeout</h3>

<p>To increase performance, permissions are cached in the system. When the <code class="highlighter-rouge">data-auth</code> property of a
webstrate is modified, the cache is invalidated. However, as a failsafe, permissions also time out
after a set period of time. This can be configured with <code class="highlighter-rouge">auth.permissionTimeout</code>, which defines the
number of seconds permissions can be remain cached before they need to be revalidated. (default
300 seconds).</p>

<h3 id="cookie">Cookie</h3>

<p>Webstrates uses cookies to save the user’s credentials. The cookie’s name (<code class="highlighter-rouge">cookieName</code>), encryption
key (<code class="highlighter-rouge">secret</code>) and life time (<code class="highlighter-rouge">duration</code>) can be configured. The <code class="highlighter-rouge">duration</code> is defined in
milliseconds and defaults to 31536000000 (365 days).</p>

<p>While the default <code class="highlighter-rouge">cookieName</code> and <code class="highlighter-rouge">duration</code> are fine, the <code class="highlighter-rouge">secret</code> <em>should</em> be changed by the user
before running Webstrates! Any random text string of 30+ characters is sufficient.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"cookie"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is a secret"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"cookieName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"session"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"duration"</span><span class="p">:</span><span class="w"> </span><span class="mi">31536000000</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h2 id="multi-threading">Multi-threading</h2>

<p>To enable multithreading, Redis must be installed (to be used for publish/subscribe between
threads) and the config must contain to properties, namely:</p>

<ul>
  <li><code class="highlighter-rouge">pubsub</code> which must be set to the Redis connection url, and</li>
  <li><code class="highlighter-rouge">threads</code> which must contain the number of desired threads.</li>
</ul>

<p>For example:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w">  </span><span class="s2">"pubsub"</span><span class="err">:</span><span class="w"> </span><span class="s2">"redis://localhost:6379/"</span><span class="err">,</span><span class="w">
  </span><span class="s2">"threads"</span><span class="err">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></code></pre>
</div>

<p>If <code class="highlighter-rouge">threads</code> is set to 0, Webstrates will automatically create one thread for each CPU core.</p>

<h2 id="tagging">Tagging</h2>

<p><a href="/userguide/api/tagging.html#auto-tagging">Auto-tagging</a> can also be configured. Currently, only
very basic configuration is possible, namely:</p>

<ul>
  <li><code class="highlighter-rouge">autoTagInterval</code> which defines how long a webstrate must have been “inactive” (without ops) for
it to become autotagged on next action (default 3600 seconds (60 minutes)).</li>
  <li><code class="highlighter-rouge">tagPrefix</code> defines the prefix of the tag that’ll be created (default “Session of “).</li>
</ul>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w">  </span><span class="s2">"tagging"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"autotagInterval"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
    </span><span class="nt">"tagPrefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Session of "</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre>
</div>

<p>Tags are postfixed with the current date time, so a tag might look something like:
“Session of Thu Jun 29 2017 14:03:30 GMT+0200 (CEST)”.</p>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-104382751-1', 'auto');
ga('send', 'pageview');
</script>

			</div>
		</main>
		<footer>
			Documentation for <a href="https://github.com/Webstrates/Webstrates">Webstrates</a>
		</footer>
	</div>
</body>
</html>
