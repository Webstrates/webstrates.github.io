<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Events | Webstrates</title>
	<meta name="description" content="A research prototype enabling collaborative editing of websites through DOM manipulations.">
	<link rel="stylesheet" href="/css/syntax.css">
	<link rel="stylesheet" href="/css/main.css">
</head>
<body>
	<div id="container">
		<header>
			<h1>
				<a class="brand" href="/">Webstrates</a>
				<small>A research prototype enabling collaborative editing of websites through DOM manipulations.</small>
			</h1>
		</header>
		<main>
			<div id="navigation">
				<ul class="nav nav-list">
					<li class="home"><a href="/">Home</a></li>
					<li>
						<a class="nav-header" href="">Getting started</a>
						<ul>
							<!--li><a href="/gettingstarted/motivation.html">Motivation</a></li-->
							<li><a href="/gettingstarted/installation.html">Installation</a></li>
							<li><a href="/gettingstarted/hello-world.html">Hello, world</a></li>
							<li><a href="/userguide/tutorials.html">Tutorials</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">User guide</a>
						<ul>
							<li><a href="/userguide/api.html">API</a></li>
							<li>
								<ul>
									<li><a class="active" href="/userguide/api/events.html">Events</a></li>
									<li><a href="/userguide/api/transient.html">Transient</a></li>
									<li><a href="/userguide/api/cookies.html">Cookies</a></li>
									<li><a href="/userguide/api/assets.html">Assets</a></li>
									<li><a href="/userguide/api/signaling.html">Signaling</a></li>
									<li><a href="/userguide/api/messaging.html">Messaging</a></li>
									<li><a href="/userguide/api/tagging.html">Tagging</a></li>
									<li><a href="/userguide/api/access-tokens.html">Access Tokens</a></li>
									<li><a href="/userguide/api/restore-delete.html">Restore/Delete</a></li>
								</ul>
							</li>
							<li><a href="/userguide/http-api.html">HTTP API</a></li>
							<li><a href="/userguide/server-config.html">Server Config</a></li>
							<li><a href="/userguide/client-config.html">Client Config</a></li>
							<li><a href="/userguide/versioning.html">Versioning</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">Developer guide</a>
						<ul>
							<li><a href="/developerguide/introduction.html">Introduction</a></li>
							<li><a href="/developerguide/how-it-works.html">How it works</a></li>
							<li><a href="/developerguide/creating-a-module.html">Creating a module</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div id="content">
				<div class="page-header">
					<h1>Events
						
					</h1>
				</div>
				<ul id="markdown-toc">
  <li><a href="#trigger-event-when-a-webstrate-has-finished-loading" id="markdown-toc-trigger-event-when-a-webstrate-has-finished-loading">Trigger event when a webstrate has finished loading</a></li>
  <li><a href="#events-on-text-nodes" id="markdown-toc-events-on-text-nodes">Events on text nodes</a></li>
  <li><a href="#added-and-removed-nodes" id="markdown-toc-added-and-removed-nodes">Added and removed nodes</a></li>
  <li><a href="#changing-attributes" id="markdown-toc-changing-attributes">Changing attributes</a></li>
  <li><a href="#prime-events" id="markdown-toc-prime-events">Prime events</a></li>
  <li><a href="#full-list-of-on-events" id="markdown-toc-full-list-of-on-events">Full list of <code class="highlighter-rouge">on</code> events</a></li>
  <li><a href="#unregistering-event-listeners" id="markdown-toc-unregistering-event-listeners">Unregistering event listeners</a></li>
</ul>

<p>The user may subscribe to certain events triggered by Webstrates using <code class="highlighter-rouge">webstrate.on(event, function)</code> (the webstrate instance) or <code class="highlighter-rouge">DOMElement.webstrate.on(event, function)</code> (the webstrate object attached to every DOM element). When an event occurs, the attached function will be triggered with potential arguments.</p>

<h2 id="trigger-event-when-a-webstrate-has-finished-loading">Trigger event when a webstrate has finished loading</h2>

<p>When the Webstrates client has finished loading a webstrate, it will trigger a <code class="highlighter-rouge">loaded</code> event on the Webstrate instance. Using the default <code class="highlighter-rouge">client.html</code> and <code class="highlighter-rouge">client.js</code>,  the webstrate instance will be attached to the window element as <code class="highlighter-rouge">window.webstrate</code>. Thus, a user may attach events to <code class="highlighter-rouge">webstrate.on</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"loaded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">webstrateId</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// The Webstrates client has now finished loading.</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If a webstrate has been transcluded (i.e. loaded in an iframe), a <code class="highlighter-rouge">transcluded</code> event will be triggered, both within the transcluded iframe, but also on the iframe element itself:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">myIframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"iframe"</span><span class="p">);</span>
<span class="nx">myIframe</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">"/some_webstrate"</span><span class="p">;</span>
<span class="nx">myIframe</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"transcluded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">webstrateId</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// The webstrate client in the iframe has now finished loading.</span>
<span class="p">});</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">myIframe</span><span class="p">);</span>
</code></pre>
</div>

<p>If the client is logged in using a passport provider (like GitHub), <code class="highlighter-rouge">user</code> will be an object containinig a <code class="highlighter-rouge">userId</code>, <code class="highlighter-rouge">username</code>, <code class="highlighter-rouge">provider</code> and <code class="highlighter-rouge">displayName</code>. This object is also available on the global <code class="highlighter-rouge">webstrate</code> instance as <code class="highlighter-rouge">webstrate.user</code>.</p>

<h2 id="events-on-text-nodes">Events on text nodes</h2>

<p>Webstrates does fine-grained synchronization on text nodes and attributes, however, to update a text node or attribute in the browser, the whole text is replaced. To allow more fine-grained interaction with text, Webstrates also dispatches text insertion and deletion events on text nodes and element nodes:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">textNode</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"insertText"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Some text has just been inserted into textNode by another client.</span>
<span class="p">});</span>

<span class="nx">textNode</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"deleteText"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Some text has just been deleted from textNode by another client.</span>
<span class="p">});</span>

<span class="nx">elementNode</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"insertText"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">attributeName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Some text has just been inserted into an attribute on elementNode by another client.</span>
<span class="p">});</span>

<span class="nx">elementNode</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"deleteText"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">attributeName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Some text has just been deleted from an attribute on textNode by another client.</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="added-and-removed-nodes">Added and removed nodes</h2>

<p>Listening for added or removed nodes can be done using <code class="highlighter-rouge">nodeAdded</code> and <code class="highlighter-rouge">nodeRemoved</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">parentElement</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"nodeAdded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// A DOM node was added by another client.</span>
<span class="p">});</span>

<span class="nx">parentElement</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"nodeRemoved"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// A DOM node was removed by another client.</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="changing-attributes">Changing attributes</h2>

<p>Attribute changes will trigger <code class="highlighter-rouge">attributeChanged</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">childElement</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"attributeChanged"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attributeName</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// An attribute was changed by another client.</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If the attribute has just been added, <code class="highlighter-rouge">oldValue</code> will be <code class="highlighter-rouge">undefined</code>. If an attribute has just been removed, <code class="highlighter-rouge">newValue</code> will be <code class="highlighter-rouge">undefined</code>. If an attribute has just been updated, <code class="highlighter-rouge">oldValue</code> and <code class="highlighter-rouge">newValue</code> will contain what you’d expect.</p>

<h2 id="prime-events">Prime events</h2>

<p>DOM events come in two flavors, regular events and prime events.</p>

<p>The regular events (e.g. <code class="highlighter-rouge">nodeAdded</code>) only get triggered when another client is the cause of the event trigger, but prime events (e.g. <code class="highlighter-rouge">nodeAdded*</code>) get triggered regardless of who caused it.</p>

<p>If a user adds an element to the DOM, both the <code class="highlighter-rouge">nodeAdded</code> and <code class="highlighter-rouge">nodeAdded*</code> events will get triggered on the other clients.
However, only the <code class="highlighter-rouge">nodeAdded*</code> event will get triggered on the client that inserted the DOM element.</p>

<p>To distinguish between event triggers caused by the user himself and other users, the <code class="highlighter-rouge">local</code> parameter can be used.
The <code class="highlighter-rouge">local</code> parameter will be <code class="highlighter-rouge">true</code> if the DOM change was caused by the current client (current browser) or <code class="highlighter-rouge">falsy</code> if it originated elsewhere.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">parentElement</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"nodeAdded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// A DOM node was added by another client.</span>
<span class="p">});</span>

<span class="nx">parentElement</span><span class="p">.</span><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"nodeAdded*"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// A DOM node was added by this client.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// A DOM node was added by another client.</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="full-list-of-on-events">Full list of <code class="highlighter-rouge">on</code> events</h2>

<table>
  <thead>
    <tr>
      <th>Event</th>
      <th>Arguments</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">loaded</code></td>
      <td>webstrateId, clientId, user</td>
      <td>The document has loaded.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">transcluded</code></td>
      <td>webstrateId, clientId, user</td>
      <td>The document has been transcluded and loaded.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">clientJoin</code></td>
      <td>clientId</td>
      <td>A client joins the document.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">clientPart</code></td>
      <td>clientId</td>
      <td>A client leaves the document.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">insertText</code></td>
      <td>position, value [, attributeName]</td>
      <td>Text has been inserted into a text node/attribute.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">insertText*</code></td>
      <td>position, value [, attributeName], local</td>
      <td>Text has been inserted into a text node/attribute.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">deleteText</code></td>
      <td>position, value [, attributeName]</td>
      <td>Text has been deleted from a text node/attribute.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">deleteText*</code></td>
      <td>position, value [, attributeName], local</td>
      <td>Text has been deleted from a text node/attribute.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nodeAdded</code></td>
      <td>node</td>
      <td>A node has been added to the document.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nodeAdded*</code></td>
      <td>node, local</td>
      <td>A node has been added to the document.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nodeRemoved</code></td>
      <td>node</td>
      <td>A node has been removed from the document.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nodeRemoved*</code></td>
      <td>node, local</td>
      <td>A node has been removed from the document.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">attributeChanged</code></td>
      <td>attributeName, newValue, oldValue</td>
      <td>An attribute has been added/modified/deleted.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">attributeChanged*</code></td>
      <td>attributeName, newValue, oldValue, local</td>
      <td>An attribute has been added/modified/deleted.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookieUpdateHere</code></td>
      <td>key, value</td>
      <td>A “here” cookie has been added/modified.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookieUpdateAnywhere</code></td>
      <td>key, value</td>
      <td>An “anywhere” cookie has been added/modified.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">signal</code></td>
      <td>message, senderId, node</td>
      <td>A client (senderId) signals on a DOM node.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tag</code></td>
      <td>version, label</td>
      <td>A tag has been added to the webstrate.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">untag</code></td>
      <td>version</td>
      <td>A tag has been removed from the webstrate.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">asset</code></td>
      <td>asset object (version, file name, etc.)</td>
      <td>An asset has been added to the webstrate.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">permissionsChanged</code></td>
      <td>newPermissions, oldPermissions</td>
      <td>The user’s document permissions has changed.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">connect</code></td>
      <td> </td>
      <td>The user has been connected.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">disconnect</code></td>
      <td> </td>
      <td>The user has been disconnected.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">reconnect </code></td>
      <td> </td>
      <td>The user reconnects after having been disconnected.</td>
    </tr>
  </tbody>
</table>

<h2 id="unregistering-event-listeners">Unregistering event listeners</h2>

<p>All the events can also be unregistered using <code class="highlighter-rouge">off</code>, e.g.:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"loaded"</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">loadedFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Work here...</span>
  <span class="nx">webstrate</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">"loaded"</span><span class="p">,</span> <span class="nx">loadedFunction</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>



				<div>

					<div id="navigation"></div>
					<div id="disqus">
<div id="disqus_thread"></div>
<script type="text/javascript">
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + 'webstrates' + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

	function waitForIframe(callback) {
		var iframe = 	document.querySelector('iframe[id^=dsq]');
		if (iframe) return callback(iframe);
		setTimeout(waitForIframe, 0, callback);
	}
	waitForIframe(function(iframe) {
		var scale = 0.88, width = 1/scale * 100, offset = (width - 100) / 2;
		iframe.setAttribute("style", `transform:scale(${scale});width:${width}%;margin-left:-${offset}%;`);
	});
})();
</script>
					</div>

				</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-104382751-1', 'auto');
ga('send', 'pageview');
</script>

			</div>
		</main>
		<footer>
			Documentation for <a href="https://github.com/Webstrates/Webstrates">Webstrates</a>
		</footer>
	</div>
</body>
</html>
