<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Messaging | Webstrates</title>
	<meta name="description" content="A research prototype enabling collaborative editing of websites through DOM manipulations.">
	<link rel="stylesheet" href="/css/syntax.css">
	<link rel="stylesheet" href="/css/main.css">
</head>
<body>
	<div id="container">
		<header>
			<h1>
				<a class="brand" href="/">Webstrates</a>
				<small>A research prototype enabling collaborative editing of websites through DOM manipulations.</small>
			</h1>
		</header>
		<main>
			<div id="navigation">
				<ul class="nav nav-list">
					<li class="home"><a href="/">Home</a></li>
					<li>
						<a class="nav-header" href="">Getting started</a>
						<ul>
							<!--li><a href="/gettingstarted/motivation.html">Motivation</a></li-->
							<li><a href="/gettingstarted/installation.html">Installation</a></li>
							<li><a href="/gettingstarted/hello-world.html">Hello, world</a></li>
							<li><a href="/userguide/tutorials.html">Tutorials</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">User guide</a>
						<ul>
							<li><a href="/userguide/api.html">API</a></li>
							<li>
								<ul>
									<li><a href="/userguide/api/events.html">Events</a></li>
									<li><a href="/userguide/api/transient.html">Transient</a></li>
									<li><a href="/userguide/api/cookies.html">Cookies</a></li>
									<li><a href="/userguide/api/assets.html">Assets</a></li>
									<li><a href="/userguide/api/signaling.html">Signaling</a></li>
									<li><a class="active" href="/userguide/api/messaging.html">Messaging</a></li>
									<li><a href="/userguide/api/tagging.html">Tagging</a></li>
									<li><a href="/userguide/api/access-tokens.html">Access Tokens</a></li>
									<li><a href="/userguide/api/restore-delete.html">Restore/Delete</a></li>
								</ul>
							</li>
							<li><a href="/userguide/http-api.html">HTTP API</a></li>
							<li><a href="/userguide/server-config.html">Server Config</a></li>
							<li><a href="/userguide/client-config.html">Client Config</a></li>
							<li><a href="/userguide/versioning.html">Versioning</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">Developer guide</a>
						<ul>
							<li><a href="/developerguide/introduction.html">Introduction</a></li>
							<li><a href="/developerguide/how-it-works.html">How it works</a></li>
							<li><a href="/developerguide/creating-a-module.html">Creating a module</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div id="content">
				<div class="page-header">
					<h1>Messaging
						
					</h1>
				</div>
				<p>Messaging allows users to send cross-webstrate messages between users, even when a user isn’t
online. It’s basically emails for Webstrates.</p>

<p>To send a message to a user (or several), call</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">recipients</span><span class="p">);</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">message</code> object can be any serializable JavaScript object (string, number, array, object…).
<code class="highlighter-rouge">recipients</code> can be either a <code class="highlighter-rouge">userId</code> (<code class="highlighter-rouge">username:provider</code>, e.g. <code class="highlighter-rouge">kbadk:github</code>), a current or
recently used <code class="highlighter-rouge">clientId</code>, or a list containing a combination of the former two.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s2">"Hello, world!"</span><span class="p">,</span> <span class="s2">"kbadk:github"</span><span class="p">)</span>
</code></pre>
</div>

<p>and</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">message</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="p">[</span><span class="s2">"quux"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">]</span> <span class="p">},</span> <span class="p">[</span><span class="s2">"B1bvxz0DNZ"</span><span class="p">,</span> <span class="s2">"kbadk:github"</span><span class="p">])</span>
</code></pre>
</div>

<p>are therefore both legal.</p>

<p>Only logged in users can send and receive messages.</p>

<p>Whenever a message is sent, it’ll be delivered to all connected clients as well as saved on the
server. Listening for messages can be done using the <code class="highlighter-rouge">message</code> event on the global webstrate object.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">senderId</span><span class="p">,</span> <span class="nx">messageId</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// message being the message object (e.g. "Hello, world!"), senderId being the sending</span>
  <span class="c1">// userId (e.g. "kbadk:github", never "B1bvxz0DNZ"), and messageId a random string</span>
  <span class="c1">// assigned to the message by the server (e.g. "rkwJJCP4Z").</span>
<span class="p">});</span>
</code></pre>
</div>

<p>This callback would also get triggered shortly after the <code class="highlighter-rouge">loaded</code> event has triggered in a document,
once for every message stored. As long as messages have not been deleted, these events will keep
getting triggered, until they expire. Messages automatically expire after 30 days.</p>

<p>Additionally, all messages are accessible in <code class="highlighter-rouge">webstrate.messages</code>.</p>

<p>To prevent the same messages from getting triggered on every load, they can be deleted, either by
deleting all messages:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">deleteMessages</span><span class="p">();</span>
</code></pre>
</div>

<p>Or by deleting single messages by messageId:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">deleteMessage</span><span class="p">(</span><span class="nx">messageId</span><span class="p">);</span>
</code></pre>
</div>

<div class="info box">
	<p><strong>A word on message persistence:</strong> Messages aren't automatically deleted from the
	server  after they have been received by a client, because we won't know if any of the receiving
	webstrates handles the messages appropriately.</p>
	<p>One can easily imagine a scenario where messages were intended for consumption in Webstrate A,
	but the recipient was only connected to Webstrate B at the time. As messages are addressed to
	users (not webstrates), Webstrate B would end up consuming the messages intended for Webstrate A
	as long as the user remained connected to the Webstrate B.</p>

	<p>Users are therefore required to manually delete messages to acknowledge that they have indeed
	handled the messages appropriately.</p>
</div>



				<div>

					<div id="navigation"></div>
					<div id="disqus">
<div id="disqus_thread"></div>
<script type="text/javascript">
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + 'webstrates' + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

	function waitForIframe(callback) {
		var iframe = 	document.querySelector('iframe[id^=dsq]');
		if (iframe) return callback(iframe);
		setTimeout(waitForIframe, 0, callback);
	}
	waitForIframe(function(iframe) {
		var scale = 0.88, width = 1/scale * 100, offset = (width - 100) / 2;
		iframe.setAttribute("style", `transform:scale(${scale});width:${width}%;margin-left:-${offset}%;`);
	});
})();
</script>
					</div>

				</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-104382751-1', 'auto');
ga('send', 'pageview');
</script>

			</div>
		</main>
		<footer>
			Documentation for <a href="https://github.com/Webstrates/Webstrates">Webstrates</a>
		</footer>
	</div>
</body>
</html>
