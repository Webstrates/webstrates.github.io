<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Assets | Webstrates</title>
	<meta name="description" content="A research prototype enabling collaborative editing of websites through DOM manipulations.">
	<link rel="stylesheet" href="/css/syntax.css">
	<link rel="stylesheet" href="/css/main.css">
</head>
<body>
	<div id="container">
		<header>
			<h1>
				<a class="brand" href="/">Webstrates</a>
				<small>A research prototype enabling collaborative editing of websites through DOM manipulations.</small>
			</h1>
		</header>
		<main>
			<div id="navigation">
				<ul class="nav nav-list">
					<li class="home"><a href="/">Home</a></li>
					<li>
						<a class="nav-header" href="">Getting started</a>
						<ul>
							<!--li><a href="/gettingstarted/motivation.html">Motivation</a></li-->
							<li><a href="/gettingstarted/installation.html">Installation</a></li>
							<li><a href="/gettingstarted/hello-world.html">Hello, world</a></li>
							<li><a href="/userguide/tutorials.html">Tutorials</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">User guide</a>
						<ul>
							<li><a href="/userguide/api.html">API</a></li>
							<li>
								<ul>
									<li><a href="/userguide/api/events.html">Events</a></li>
									<li><a href="/userguide/api/transient.html">Transient</a></li>
									<li><a href="/userguide/api/cookies.html">Cookies</a></li>
									<li><a class="active" href="/userguide/api/assets.html">Assets</a></li>
									<li><a href="/userguide/api/signaling.html">Signaling</a></li>
									<li><a href="/userguide/api/messaging.html">Messaging</a></li>
									<li><a href="/userguide/api/tagging.html">Tagging</a></li>
									<li><a href="/userguide/api/access-tokens.html">Access Tokens</a></li>
									<li><a href="/userguide/api/restore-delete.html">Restore/Delete</a></li>
								</ul>
							</li>
							<li><a href="/userguide/http-api.html">HTTP API</a></li>
							<li><a href="/userguide/server-config.html">Server Config</a></li>
							<li><a href="/userguide/client-config.html">Client Config</a></li>
							<li><a href="/userguide/versioning.html">Versioning</a></li>
						</ul>
					</li>
					<li>
						<a class="nav-header" href="">Developer guide</a>
						<ul>
							<li><a href="/developerguide/introduction.html">Introduction</a></li>
							<li><a href="/developerguide/how-it-works.html">How it works</a></li>
							<li><a href="/developerguide/creating-a-module.html">Creating a module</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div id="content">
				<div class="page-header">
					<h1>Assets
						
					</h1>
				</div>
				<ul id="markdown-toc">
  <li><a href="#adding-assets" id="markdown-toc-adding-assets">Adding assets</a></li>
  <li><a href="#accessing-assets" id="markdown-toc-accessing-assets">Accessing assets</a></li>
</ul>

<p>Webstrates supports the attachment of assets (files). Files can be attached to a Webstrate by
performing a POST request with a file (or multiple files) to the webstrate’s path:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">""</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Upload"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">action</code> attribute in the above is the empty string (<code class="highlighter-rouge">""</code>), meaning the form will submit to
itself. When adding the above code to a webstrate at <code class="highlighter-rouge">/myWebstrate/</code>, and submitting the form with a
file, the request will be made to <code class="highlighter-rouge">/myWebstrate/</code> and the file added to myWebstrate. Submitting to
another webstrate is also possible by changing the <code class="highlighter-rouge">action</code> attribute.</p>

<p>Note that forms <em>must</em> have <code class="highlighter-rouge">enctype="multipart/form-data"</code> to be recognized by the Webstrates
server.</p>

<h2 id="adding-assets">Adding assets</h2>

<p>Uploading an asset will attach it to the current version of the document, but may also be accessed
by future versions, assuming no other asset has been added with the same name since.</p>

<p>For instance,
uploading <code class="highlighter-rouge">cow.jpg</code> at version 1 to myWebstrate will make it possible to access it at
<code class="highlighter-rouge">/myWebstrate/cow.jpg</code>, <code class="highlighter-rouge">/myWebstrate/1/cow.jpg</code>, <code class="highlighter-rouge">/myWebstrate/2/cow.jpg</code> etc., assuming those
versions exist.</p>

<p>If, however, another <code class="highlighter-rouge">cow.jpg</code> is uploaded at version 3, any requests to
<code class="highlighter-rouge">/myWebstrate/3/cow.jpg</code>, <code class="highlighter-rouge">/myWebstrate/4/cow.jpg</code> and so forth will refer to the new <code class="highlighter-rouge">cow.jpg</code>, but
any requests to previous versions will still refer to the old <code class="highlighter-rouge">cow.jpg</code>.</p>

<p>Accessing
<code class="highlighter-rouge">/myWebstrate/cow.jpg</code> will naturally always point to the newest version of <code class="highlighter-rouge">cow.jpg</code>.</p>

<p>Copying and restoring Webstrates will also take the assets into account and perform as expected:
Copying a webstrate will also copy over the assets to the new webstrate, so deleting the source
webstrate won’t result in the assets in the new webstrate disappearing. Restoring a webstrate will
bump the version of the older assets (e.g. the first version of <code class="highlighter-rouge">cow.jpg</code>) to the version of the
restored webstrate.</p>

<p>When submitting an asset, the server will return a JSON object representing the asset, e.g.:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"v"</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w">
  </span><span class="nt">"fileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cow.jpg"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"fileSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">138666</span><span class="p">,</span><span class="w">
  </span><span class="nt">"mimeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"image/jpg"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"identifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eddc9c8937d6447c550433c5a3f20a65"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>In the above example, we have uploaded an image <code class="highlighter-rouge">cow.jpg</code> with a size of 135 KB (138666 bytes) to
version 128 of the document (the current version). The assets has also been given the unique
identifier <code class="highlighter-rouge">eddc9c8937d6447c550433c5a3f20a65</code> in the system. When copying/restoring webstrates,
files may get different version numbers, making it hard to keep track of a specific version of an
asset. The identifier solves this, as the identifier always refers to the same version of an asset.</p>

<p>Note that an asset is always attached to the newest version of a webstrate, because the philosophy
of Webstrates is to never modify the history of a document, but only append to it. Adding an asset
to a previous version would modify the history of the document. For the same reason, restoring a
webstrate also doesn’t modify the history, but only appends to it. Assets cannot be deleted, except
by deleting the entire document.</p>

<h2 id="accessing-assets">Accessing assets</h2>

<p>All assets for a webstrate can be listed by making a GET request to <code class="highlighter-rouge">/&lt;webstrateId&gt;/?assets</code> or by
calling <code class="highlighter-rouge">webstrate.assets</code>. Additionally, it is possible to get notified whenever an asset is
added to the webstrate. This is done by listening for the <code class="highlighter-rouge">asset</code> event:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webstrate</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"asset"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">asset</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Asset was added to the webstrate.</span>
<span class="p">});</span>
</code></pre>
</div>

<p>The asset object will be similar to the one shown above.</p>



				<div>

					<div id="navigation"></div>
					<div id="disqus">
<div id="disqus_thread"></div>
<script type="text/javascript">
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + 'webstrates' + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

	function waitForIframe(callback) {
		var iframe = 	document.querySelector('iframe[id^=dsq]');
		if (iframe) return callback(iframe);
		setTimeout(waitForIframe, 0, callback);
	}
	waitForIframe(function(iframe) {
		var scale = 0.88, width = 1/scale * 100, offset = (width - 100) / 2;
		iframe.setAttribute("style", `transform:scale(${scale});width:${width}%;margin-left:-${offset}%;`);
	});
})();
</script>
					</div>

				</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-104382751-1', 'auto');
ga('send', 'pageview');
</script>

			</div>
		</main>
		<footer>
			Documentation for <a href="https://github.com/Webstrates/Webstrates">Webstrates</a>
		</footer>
	</div>
</body>
</html>
